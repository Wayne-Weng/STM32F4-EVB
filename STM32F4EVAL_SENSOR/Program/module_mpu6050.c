/*==============================================================================================*/
/*==============================================================================================*/
#include "stm32f4_system.h"
#include "stm32f4_i2c.h"
#include "module_mpu6050.h"
#include "interface.h"
/*==============================================================================================*/
/*==============================================================================================*
**函數 : MPU6050_Init
**功能 : 初始化MPU6050
**輸入 : None
**輸出 : SUCCESS/ERROR
**使用 : MPU6050_Init();
**==============================================================================================*/
/*==============================================================================================*/
u8 MPU6050_Init( void )
{
  u8 i = 0;
  u8 MPU6050_Init_Data[6][2] = {
      {0x01, MPU6050_PWR_MGMT_1},   // Reset device
      {0x03, MPU6050_CONFIG},       // 
      {0x18, MPU6050_GYRO_CONFIG},  // +-2000dps
      {0x08, MPU6050_ACCEL_CONFIG}, // +-4G
      {0x32, MPU6050_INT_PIN_CFG},  // 
      {0x00, MPU6050_USER_CTRL}     // 
    };

  for(i=0; i<6; i++) {
    I2C_DMA_WriteReg(MPU6050_I2C_ADDR, MPU6050_Init_Data[i][1], MPU6050_Init_Data[i], 1);
    Delay_1ms(10);
  }

  return SUCCESS;
}
/*==============================================================================================*/
/*==============================================================================================*
**函數 : MPU6050_Read
**功能 : Read MPU6050
**輸入 : None
**輸出 : SUCCESS/ERROR
**使用 : MPU6050_Read();
**==============================================================================================*/
/*==============================================================================================*/
void MPU6050_Read( s16* IMU_Buf )
{
  u8 ReadBuf[14] = {0};

  I2C_DMA_ReadReg(MPU6050_I2C_ADDR, MPU6050_ACCEL_XOUT_H, ReadBuf, 14);

  IMU_Buf[0] = (s16)((ReadBuf[0]  << 8) | ReadBuf[1]);
  IMU_Buf[1] = (s16)((ReadBuf[2]  << 8) | ReadBuf[3]);
  IMU_Buf[2] = (s16)((ReadBuf[4]  << 8) | ReadBuf[5]);
  IMU_Buf[3] = (s16)((ReadBuf[6]  << 8) | ReadBuf[7]);
  IMU_Buf[4] = (s16)((ReadBuf[8]  << 8) | ReadBuf[9]);
  IMU_Buf[5] = (s16)((ReadBuf[10] << 8) | ReadBuf[11]);
  IMU_Buf[6] = (s16)((ReadBuf[12] << 8) | ReadBuf[13]);
}
/*==============================================================================================*/
/*==============================================================================================*/
